install.packages("fastmap")
install.packages("fastmap")
knitr::opts_chunk$set(echo = TRUE)
rm(list=ls())
pacman::p_load(dplyr, gtsummary, flextable, ggplot2,
usmap, wesanderson)
dir <- "C:/Users/msahu/OneDrive - UW/Documents/Research/PCMA/"
in_dir <- paste0(dir, "00_data/processed/NCPDP/")
data <- readRDS(paste0(in_dir, "ncpdp_cleaned.rds")) %>%
mutate(closure = ifelse(closure_date != "00000000", 1, 0),
"Year of Closure" = closure_year,
"Pharmacy Type" = classR)
dataset_name <- "National Council for Prescription Drug Programs (NCDP), June 2023"
# Table output for Word (change YAML to "word_document")
# theme_gtsummary_printer(
#   print_engine = "flextable",
#   set_theme = TRUE
# )
data %>% select(`Pharmacy Type`, closure_year, closure, type1, type2, type3) %>%  tbl_summary()
data %>% select(closure, closure_year, `Pharmacy Type`, type1, type2, type3) %>%  tbl_summary()
data %>% select(closure, closure_year, `Pharmacy Type`, open24hours) %>%  tbl_summary()
knitr::opts_chunk$set(echo = TRUE)
rm(list=ls())
pacman::p_load(dplyr, gtsummary, flextable, ggplot2,
usmap, wesanderson)
dir <- "C:/Users/msahu/OneDrive - UW/Documents/Research/PCMA/"
in_dir <- paste0(dir, "00_data/processed/NCPDP/")
data <- readRDS(paste0(in_dir, "ncpdp_cleaned.rds")) %>%
mutate(closure = ifelse(closure_date != "00000000", 1, 0),
"Pharmacy Closures" = closure,
"Year of Closure" = closure_year,
"Pharmacy Type" = classR,
`Open 24 Hours?` = ifelse(open24hours == "Y", "Yes", "No"))
dataset_name <- "National Council for Prescription Drug Programs (NCDP), June 2023"
# Table output for Word (change YAML to "word_document")
# theme_gtsummary_printer(
#   print_engine = "flextable",
#   set_theme = TRUE
# )
data %>% select(closure, `Year of closure`, `Pharmacy Type`, open24hours) %>%  tbl_summary()
data %>% select(`Pharmacy Closures`, `Year of Closure`, `Pharmacy Type`, `Open 24 Hours?`) %>%  tbl_summary()
rm(list=ls())
library(RColorBrewer)
par(mar=c(3,4,2,2))
display.brewer.all()
library(RColorBrewer)
display.brewer.all(type = "seq")
par(mar=c(3,4,2,2))
display.brewer.all()
library(RColorBrewer)
par(mar=c(3,4,2,2))
display.brewer.all()
pal <- brewer.pal(5, "PrGN")  # we select 5 colors from the palette
library(RColorBrewer)
par(mar=c(3,4,2,2))
display.brewer.all()
pal <- brewer.pal(5, "PRGn")  # we select 5 colors from the palette
knitr::opts_chunk$set(echo = TRUE)
# Setup
rm(list=ls())
pacman::p_load(dplyr, gtsummary, flextable, ggplot2,
usmap, wesanderson)
# Word doc options
# theme_gtsummary_printer(
#   print_engine = "flextable",
#   set_theme = TRUE
# )
# YAML:
# output:
#  word_document:
#    reference_docx: word_styles.docx
# Load and clean data
dir <- "C:/Users/msahu/OneDrive - UW/Documents/Research/PCMA/"
in_dir <- paste0(dir, "00_data/processed/NCPDP/")
data <- readRDS(paste0(in_dir, "ncpdp_cleaned.rds")) %>%
mutate(closure = ifelse(closure_date != "00000000", 1, 0),
"Pharmacy Closures" = closure,
"Year of Closure" = closure_year,
"Pharmacy Type" = classR,
`Open 24 Hours?` = ifelse(open24hours == "Y", "Yes", "No"))
dataset_name <- "National Council for Prescription Drug Programs (NCDP), June 2023"
countyDF <- data %>%  group_by(county_fips) %>% summarize(closures_n = sum(closure)) %>% rename(fips = county_fips) %>% filter( fips!= "" & closures_n != 0)
plot_usmap(data = countyDF, regions = "counties", values = "closures_n") +
labs(title = "Pharmacy closures by US county",
subtitle = dataset_name) +
scale_fill_gradientn(colours = c("pink","green"), name = "Closures (n)", label = scales::comma) +
theme(legend.position = "right")
countyDF <- data %>%  group_by(county_fips) %>% summarize(closures_n = sum(closure)) %>% rename(fips = county_fips) %>% filter( fips!= "" & closures_n != 0)
plot_usmap(data = countyDF, regions = "counties", values = "closures_n") +
labs(title = "Pharmacy closures by US county",
subtitle = dataset_name) +
scale_fill_gradientn(colours = c("purple","darkgreen"), name = "Closures (n)", label = scales::comma) +
theme(legend.position = "right")
countyDF <- data %>%  group_by(county_fips) %>% summarize(closures_n = sum(closure)) %>% rename(fips = county_fips) %>% filter( fips!= "" & closures_n != 0)
plot_usmap(data = countyDF, regions = "counties", values = "closures_n") +
labs(title = "Pharmacy closures by US county",
subtitle = dataset_name) +
scale_fill_gradientn(colours = c("white","red"), name = "Closures (n)", label = scales::comma) +
theme(legend.position = "right")
countyDF <- data %>%  group_by(county_fips) %>% summarize(closures_n = sum(closure)) %>% rename(fips = county_fips) %>% filter( fips!= "" & closures_n != 0)
plot_usmap(data = countyDF, regions = "counties", values = "closures_n") +
labs(title = "Pharmacy closures by US county",
subtitle = dataset_name) +
scale_fill_gradientn(colours = c("white","orangered"), name = "Closures (n)", label = scales::comma) +
theme(legend.position = "right")
countyDF <- data %>%  group_by(county_fips) %>% summarize(closures_n = sum(closure)) %>% rename(fips = county_fips) %>% filter( fips!= "" & closures_n != 0)
plot_usmap(data = countyDF, regions = "counties", values = "closures_n") +
labs(title = "Pharmacy closures by US county",
subtitle = dataset_name) +
scale_fill_gradientn(colours = c("white","darkred"), name = "Closures (n)", label = scales::comma) +
theme(legend.position = "right")
countyDF <- data %>%  group_by(county_fips) %>% summarize(closures_n = sum(closure)) %>% rename(fips = county_fips) %>% filter( fips!= "" & closures_n != 0)
plot_usmap(data = countyDF, regions = "counties", values = "closures_n") +
labs(title = "Pharmacy closures by US county",
subtitle = dataset_name) +
scale_fill_gradientn(colours = c("white","brown4"), name = "Closures (n)", label = scales::comma) +
theme(legend.position = "right")
countyDF <- data %>%  group_by(county_fips) %>% summarize(closures_n = sum(closure)) %>% rename(fips = county_fips) %>% filter( fips!= "" & closures_n != 0)
plot_usmap(data = countyDF, regions = "counties", values = "closures_n") +
labs(title = "Pharmacy closures by US county",
subtitle = dataset_name) +
scale_fill_gradientn(colours = c("white","flame"), name = "Closures (n)", label = scales::comma) +
theme(legend.position = "right")
countyDF <- data %>%  group_by(county_fips) %>% summarize(closures_n = sum(closure)) %>% rename(fips = county_fips) %>% filter( fips!= "" & closures_n != 0)
plot_usmap(data = countyDF, regions = "counties", values = "closures_n") +
labs(title = "Pharmacy closures by US county",
subtitle = dataset_name) +
scale_fill_gradientn(colours = c("white","orangered3"), name = "Closures (n)", label = scales::comma) +
theme(legend.position = "right")
countyDF <- data %>%  group_by(county_fips) %>% summarize(closures_n = sum(closure)) %>% rename(fips = county_fips) %>% filter( fips!= "" & closures_n != 0)
plot_usmap(data = countyDF, regions = "counties", values = "closures_n") +
labs(title = "Pharmacy closures by US county",
subtitle = dataset_name) +
scale_fill_gradientn(colours = c("papayawhip","orangered3"), name = "Closures (n)", label = scales::comma) +
theme(legend.position = "right")
countyDF <- data %>%  group_by(county_fips) %>% summarize(closures_n = sum(closure)) %>% rename(fips = county_fips) %>% filter( fips!= "" & closures_n != 0)
plot_usmap(data = countyDF, regions = "counties", values = "closures_n") +
labs(title = "Pharmacy closures by US county",
subtitle = dataset_name) +
scale_fill_gradientn(colours = c("papayawhip","orangered4"), name = "Closures (n)", label = scales::comma) +
theme(legend.position = "right")
countyDF <- data %>%  group_by(county_fips) %>% summarize(closures_n = sum(closure)) %>% rename(fips = county_fips) %>% filter( fips!= "" & closures_n != 0)
plot_usmap(data = countyDF, regions = "counties", values = "closures_n") +
labs(title = "Pharmacy closures by US county",
subtitle = dataset_name) +
scale_fill_gradientn(colours = c("papayawhip","orangered3"), name = "Closures (n)", label = scales::comma) +
theme(legend.position = "right")
countyDF <- data %>%  group_by(county_fips) %>% summarize(closures_n = sum(closure)) %>% rename(fips = county_fips) %>% filter( fips!= "" & closures_n != 0)
plot_usmap(data = countyDF, regions = "counties", values = "closures_n") +
labs(title = "Pharmacy closures by US county",
subtitle = dataset_name) +
scale_fill_gradientn(colours = c("papayawhip","red3"), name = "Closures (n)", label = scales::comma) +
theme(legend.position = "right")
countyDF <- data %>%  group_by(county_fips) %>% summarize(closures_n = sum(closure)) %>% rename(fips = county_fips) %>% filter( fips!= "" & closures_n != 0)
plot_usmap(data = countyDF, regions = "counties", values = "closures_n") +
labs(title = "Pharmacy closures by US county",
subtitle = dataset_name) +
scale_fill_gradientn(colours = c("white","red3"), name = "Closures (n)", label = scales::comma) +
theme(legend.position = "right")
stateDF <- data %>%  group_by(state_code) %>% summarize(closures_n = sum(closure)) %>% rename(state = state_code)
plot_usmap(data = stateDF, regions = "states", values = "closures_n") +
labs(title = "Pharmacy closures by US state",
subtitle = dataset_name) +
scale_fill_gradientn(colours = c("white","red3"), name = "Closures (n)", label = scales::comma) +
theme(legend.position = "right")
countyDF <- data %>%  group_by(county_fips) %>% summarize(closures_n = sum(closure)) %>% rename(fips = county_fips) %>% filter( fips!= "")
plot_usmap(data = countyDF, regions = "counties", values = "closures_n") +
labs(title = "Pharmacy closures by US county",
subtitle = dataset_name) +
scale_fill_gradientn(colours = c("white","red3"), name = "Closures (n)", label = scales::comma) +
theme(legend.position = "right")
countyDF <- data %>%  group_by(county_fips) %>% summarize(closures_n = sum(closure)) %>% rename(fips = county_fips) %>% filter( fips!= "")
plot_usmap(data = countyDF, regions = "counties", values = "closures_n") +
labs(title = "Pharmacy closures by US county",
subtitle = dataset_name) +
scale_fill_gradientn(colours = c("white","red3"), name = "Closures (n)", label = scales::comma) +
annotate("text", x = 4, y = 25, label = "Some text") +
theme(legend.position = "right")
countyDF <- data %>%  group_by(county_fips) %>% summarize(closures_n = sum(closure)) %>% rename(fips = county_fips) %>% filter( fips!= "")
plot_usmap(data = countyDF, regions = "counties", values = "closures_n") +
labs(title = "Pharmacy closures by US county",
subtitle = dataset_name) +
scale_fill_gradientn(colours = c("white","red3"), name = "Closures (n)", label = scales::comma) +
annotate("text", label = "Some text") +
theme(legend.position = "right")
countyDF <- data %>%  group_by(county_fips) %>% summarize(closures_n = sum(closure)) %>% rename(fips = county_fips) %>% filter( fips!= "")
plot_usmap(data = countyDF, regions = "counties", values = "closures_n") +
labs(title = "Pharmacy closures by US county",
subtitle = paste0(dataset_name, " [Note: gray counties didn't map from NCPDP data]")) +
scale_fill_gradientn(colours = c("white","red3"), name = "Closures (n)", label = scales::comma) +
theme(legend.position = "right")
